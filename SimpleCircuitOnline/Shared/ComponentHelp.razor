@using SimpleCircuit;

@if (Show)
{
<ul class="nav nav-tabs">
    @foreach (var category in _categories.Keys)
    {
        <li class="nav-item">
            <a class="nav-link@(string.CompareOrdinal(category, _current) == 0 ? " active" : "")" style="cursor: pointer" @onclick="x => Select(category)">@category</a>
        </li>
    }
</ul>
<div class="" style="width: 100%">
    @if (_categories != null && _categories.TryGetValue(_current, out var list))
    {
        @foreach (var d in list)
        {
            <ComponentCard Component="@Context.Factory.Create(d.Key, null)" Name="@d.Name" Key="@d.Key" />
        }
    }
</div>
}

@code
{
    [Parameter]
    public bool Show
    {
        get => _show;
        set
        {
            if (_show != value)
            {
                _show = value;
                StateHasChanged();
            }
        }
    }

    private static SimpleCircuit.Parser.ParsingContext Context { get; } = new SimpleCircuit.Parser.ParsingContext();

    private bool _show = false;
    private string _current = "General";
    private Dictionary<string, List<Utility.ComponentDescription>> _categories = new Dictionary<string, List<Utility.ComponentDescription>>();

    private void Select(string category)
    {
        _current = category;
        StateHasChanged();
    }

    protected override void OnInitialized()
    {
        base.OnInitialized();

        // Find the categories
        foreach (var description in Utility.Components(typeof(SimpleCircuit.Parser.Parser).Assembly).OrderBy(d => d.Key))
        {
            string category = description.Category ?? "General";
            if (!_categories.TryGetValue(category, out var list))
            {
                list = new List<Utility.ComponentDescription>();
                _categories.Add(category, list);
            }
            list.Add(description);
        }
    }
}