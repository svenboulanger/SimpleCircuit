@using System.IO
@using System.Xml
@inject IJSRuntime JSRuntime
@implements IAsyncDisposable

@* https://www.meziantou.net/upload-files-with-drag-drop-or-paste-from-clipboard-in-blazor.htm *@

<div @ref="_dropZoneElement" class="@ContainerClasses">
    <div class="output">
        @ChildContent
        @if (!AutoUpdate)
        {
            <a class="btn toggle refresh active" href="javascript:void(0);" @onclick="RequestRefresh">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-repeat" viewBox="0 0 16 16">
                <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z" />
                <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z" />
            </svg>
        </a>
        }
    </div>
    <div class="menu clearfix">
        <a href="javascript:void(0);" class="btn toggle@(_optionsVisible ? " active" : "")" @onclick="() => _optionsVisible = !_optionsVisible">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear-fill" viewBox="0 0 16 16">
                <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z" />
            </svg>
        </a>
        @if (_optionsVisible)
        {
            <div class="options">
                <a href="javascript:void(0);" class="btn toggle@(ShrinkX ? " active" : "")" @onclick="ToggleShrinkX">Fit to width</a>
                <a href="javascript:void(0);" class="btn toggle@(ShrinkY ? " active" : "")" @onclick="ToggleShrinkY">Fit height</a>
                <a href="javascript:void(0);" class="btn toggle@(Bounds ? " active" : "")" @onclick="ToggleBounds">Render element bounds</a>
                <a href="javascript:void(0);" class="btn toggle@(AutoUpdate ? " active" : "")" @onclick="ToggleAutoUpdate">Auto update</a>
            </div>
        }
        <EditForm Model="this" class="form-inline my-2 mx-3">
            <InputText @bind-Value="InternalFilename" class="form-control" placeholder="Filename" aria-label="Filename" />
        </EditForm>
        <a href="javascript:void(0);" class="btn download" @onclick="DownloadSVG">
            <DownloadIcon /> SVG
        </a>
        <a href="javascript:void(0);" class="btn download" @onclick="DownloadPNG">
            <DownloadIcon /> PNG
        </a>
        <a href="javascript:void(0);" class="btn download" @onclick="DownloadJPG">
            <DownloadIcon /> JPG
        </a>
        <label for="file-upload" class="btn upload">
            <div class="hidden">
                <InputFile OnChange="@OnChange" @ref="_inputFile" accept=".svg" id="file-upload" class="d-none" />
            </div>
            <UploadIcon /> SVG meta
        </label>
    </div>
</div>